<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.18.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Twitter Sentiment Analysis - Kyle Amyx</title>
<meta name="description" content="Data Science ">


  <meta name="author" content="Kyle Amyx">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kyle Amyx">
<meta property="og:title" content="Twitter Sentiment Analysis">
<meta property="og:url" content="http://localhost:4000/twitter/">


  <meta property="og:description" content="Data Science ">



  <meta property="og:image" content="http://localhost:4000/assets/images/twitter/twitter-header.png">





  <meta property="article:published_time" content="2020-06-06T00:00:00-04:00">





  

  


<link rel="canonical" href="http://localhost:4000/twitter/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Kyle Amyx",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kyle Amyx Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/osu_logo_small.png" alt=""></a>
        
        <a class="site-title" href="/">
          Kyle Amyx
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li><li class="masthead__menu-item">
              <a href="/datascience/" >Data science</a>
            </li><li class="masthead__menu-item">
              <a href="/android/" >Mobile Dev</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="/assets/images/twitter/twitter-header.png" alt="Twitter Sentiment Analysis" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/bio_image.jpg" alt="Kyle Amyx" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Kyle Amyx</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Data Science Portfolio</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Columbus, OH</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/masteramyx" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/kyle-amyx-0865aa91/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Twitter Sentiment Analysis">
    <meta itemprop="description" content="Data Science">
    <meta itemprop="datePublished" content="2020-06-06T00:00:00-04:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Twitter Sentiment Analysis
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  14 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="introduction">Introduction</h1>
<p>Sentiment Analysis is the process of predicting whether a piece of information(usually text) indicates
a positive, negative or neutral sentiment on a topic.</p>

<p>This project allows the user to input a keyword and gathers tweets based on it, then analyzes the sentiments of those tweets.</p>

<p>A classifier is <code class="highlighter-rouge">Supervised</code> if it is built on training corpuses containing the correct label for each input. The framework for supervised classification is described by the diagram shown below.</p>

<p><img src="/assets/images/twitter/supervised_learning.png" alt="" /></p>

<p>The work flow for this task will follow the shown framework. Taking our training set, a feature extractor converts each item into a feature set. These feature sets along with each input item’s label are put into our ML Algorithm to develop a model. During the prediction phase, the same feature extractor is used to convert the test set inputs into feture sets, these feature sets will have a label of <code class="highlighter-rouge">Null</code> or <code class="highlighter-rouge">None</code>. They are then put into the model which generates predicted labels to replace the <code class="highlighter-rouge">Null</code> or <code class="highlighter-rouge">None</code></p>

<h1 id="getting-started">Getting Started</h1>
<p>Let’s start with defining the packages required for fetching and reading/writing the data.</p>

<p>The Python Twitter API Wrapper Docs can be found here…<br />
<a href="https://python-twitter.readthedocs.io/en/latest/twitter.html#twitter.api.Api.GetSearch">Python-Twitter Documentation</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">twitter</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pickle</span>
</code></pre></div></div>

<p>Next, we’ll define the packages required for the pre-processing of the data, as well as the classification.</p>

<p>We will be using NLTK(Natural Language Toolkit) for the heavy lifting. The package comes with predefined <code class="highlighter-rouge">stopwords</code> and <code class="highlighter-rouge">punctuation</code>.</p>

<p>Stop words are generally the most common words in a language, these along with punctuation do not assist predicting the sentiment and only take up valuable space. They are removed during pre-processing to reduce the computational load on the models.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">word_tokenize</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">punctuation</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">import</span> <span class="nn">nltk</span>
<span class="c1">#!{sys.executable} -m pip install pattern
</span><span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s">'stopwords'</span><span class="p">)</span>
<span class="n">nltk</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s">'punkt'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="connecting-to-twitter">Connecting to Twitter</h2>
<p>The first step required is to connect to Twitter’s developer API. This is necessary to retrieve the data we would like to test our classifier on.</p>

<p>You can start by applying for access at… <br />
<a href="!https://developer.twitter.com/en">Twitter Api</a></p>

<p>Once you have API credentials we can verify by caling <code class="highlighter-rouge">VerifyCredentials()</code></p>

<p>As we can see, all my twitter information is returned in JSON response which includes a <code class="highlighter-rouge">User</code> object, so we’re good to go.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Fun Python Trick, just print the import object to see full file path, helps with
# troubleshooting import issues.
</span><span class="k">print</span><span class="p">(</span><span class="n">twitter</span><span class="p">)</span>
<span class="c1"># init api instance
</span><span class="n">twitter_api</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="n">Api</span><span class="p">(</span><span class="n">consumer_key</span><span class="o">=</span><span class="s">'CONSUMER_KEY'</span><span class="p">,</span>
                         <span class="n">consumer_secret</span><span class="o">=</span><span class="s">'CONSUMER_SECRET'</span><span class="p">,</span>
                         <span class="n">access_token_key</span><span class="o">=</span><span class="s">'ACCESS_TOKEN_KEY'</span><span class="p">,</span>
                         <span class="n">access_token_secret</span><span class="o">=</span><span class="s">'ACCESS_TOKEN_SECRET'</span><span class="p">)</span>

<span class="n">twitter_info</span> <span class="o">=</span> <span class="n">twitter_api</span><span class="o">.</span><span class="n">VerifyCredentials</span><span class="p">()</span>
<span class="n">json_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">twitter_info</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_object</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;module 'twitter' from 'D:\\anaconda3\\lib\\site-packages\\twitter\\__init__.py'&gt;
{
  "created_at": "Mon Apr 16 03:05:50 +0000 2018",
  "default_profile": true,
  "description": "Ohio State Data Analytics | Android Dev",
  "favourites_count": 22,
  "followers_count": 12,
  "friends_count": 57,
  .
  .
  .
  },
  "statuses_count": 50
}
</code></pre></div></div>

<h2 id="building-test-set">Building Test Set</h2>

<p>Now that the API credentials have been verified, let’s write a function which will fetch tweets from Twitter based on a topic keyword.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">getTestSet</span><span class="p">(</span><span class="n">keyword</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tweets</span> <span class="o">=</span> <span class="n">twitter_api</span><span class="o">.</span><span class="n">GetSearch</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">'en'</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Fetched "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tweets</span><span class="p">))</span> <span class="o">+</span> <span class="s">"tweets for the term "</span> <span class="o">+</span> <span class="n">keyword</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span><span class="n">status</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">"label"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span> <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Error"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<p>When running this code chunk, the user is prompted to enter the <code class="highlighter-rouge">keyword</code> which is then passed to our function <code class="highlighter-rouge">getTestSet(keyword)</code>
This returns 100 tweets based on that keyword. <br />
 We can peek at the first 4 below to get an idea of what we are working with. <br />
As you can see, we’ve created a new object containing the tweet but also a <code class="highlighter-rouge">label</code> which as stated before will be temporarily labeled <code class="highlighter-rouge">null</code> until we perform the prediction.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">search_term</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter word: "</span><span class="p">)</span>
<span class="n">testDataSet</span> <span class="o">=</span> <span class="n">getTestSet</span><span class="p">(</span><span class="n">search_term</span><span class="p">)</span>
<span class="c1">#print(testDataSet[0:4])
</span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">testDataSet</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter word: blm
Fetched 100tweets for the term blm
{
  "text": "Florida police have released footage of the mass looting of a Walmart during the BLM race riots. https://t.co/Gvv91hMzcR",
  "label": null
}
{
  "text": "Imagine if Fox News was as upset about the lockdown protests as they are about BLM protests \ud83e\udd14 https://t.co/2U6BmjXJya",
  "label": null
}
{
  "text": "A stroke of genius cancelling the BLM protest. It gave the far-right centre stage to reveal who they are without an\u2026 https://t.co/pHiyVPxrri",
  "label": null
}
{
  "text": "@markgoldbridge They're gonna play with BLM on their shirts whilst playing football with said vulnerable group.\ud83d\ude02",
  "label": null
}
</code></pre></div></div>

<h2 id="building-training-set">Building Training Set</h2>

<h4 id="note-">NOTE: <br /></h4>
<p>First time attempting this, I used this dataset <a href="https://github.com/karanluthra/twitter-sentiment-training/blob/master/corpus.csv">Old Corpus</a> however this was very skewed and contained ~4000 neutral classifications out of a dataset of 5000 points thus leaving only ~500 Positive and Negative labels remaining. Because of this the model predicted EVERYTHING as neutral. This was a lesson learned in the importance of checking your training sets to ensure balance.</p>

<p>I ended up finding a much more balanced training set which can be found here. <br />
<a href="http://help.sentiment140.com/for-students/">New Corpus</a></p>

<p>The only adjustments that were required was to convert the classification variable from an Integer(0,2,4) String representation to a text representation(Negative, Neutral, Positive).</p>

<p>The function created for building out the training set is shown here.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">buildTwitterTraining</span><span class="p">():</span>
    <span class="n">twitterTraining</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'twitter_training.csv'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'cp1252'</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
        <span class="n">so</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s">"</span><span class="se">\"</span><span class="s">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">so</span><span class="p">):</span>
            <span class="n">labelNum</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">""</span>
            <span class="k">if</span><span class="p">(</span><span class="n">labelNum</span> <span class="o">==</span> <span class="s">'0'</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">'negative'</span>
            <span class="k">elif</span><span class="p">(</span><span class="n">labelNum</span> <span class="o">==</span> <span class="s">'2'</span><span class="p">):</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">'neutral'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s">'positive'</span>

            <span class="n">twitterTraining</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">"tweet_id"</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">"text"</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s">"label"</span><span class="p">:</span><span class="n">label</span><span class="p">})</span>
</code></pre></div></div>
<p>Pretty Print first 5 tweets of training set to give us a preview.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">twitterTraining</span> <span class="o">=</span> <span class="n">buildTwitterTraining</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">twitterTraining</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[
  {
    "tweet_id": "1467810369",
    "text": "@switchfoot http://twitpic.com/2y1zl - Awww, that's a bummer.  You shoulda got David Carr of Third Day to do it. ;D",
    "label": "negative"
  },
  {
    "tweet_id": "1467810672",
    "text": "is upset that he can't update his Facebook by texting it... and might cry as a result  School today also. Blah!",
    "label": "negative"
  },
  {
    "tweet_id": "1467810917",
    "text": "@Kenichan I dived many times for the ball. Managed to save 50%  The rest go out of bounds",
    "label": "negative"
  },
  {
    "tweet_id": "1467811184",
    "text": "my whole body feels itchy and like its on fire ",
    "label": "negative"
  },
  {
    "tweet_id": "1467811193",
    "text": "@nationwideclass no, it's not behaving at all. i'm mad. why am i here? because I can't see you all over there. ",
    "label": "negative"
  }
]
</code></pre></div></div>

<h2 id="text-preprocessing">Text Preprocessing</h2>

<p>The next step is pre-processing of the tweets…</p>

<p>This is a question of what matters and what doesn’t matter in Sentiment Analysis..</p>

<p>In NLP, text preprocessing is the practice of cleaning and preparing text data to something a computer can understand. <br />
One of the major forms of pre-processing is to filter out useless data. In NLP, useless words (data), are referred to as stop words.</p>

<p>Using NLTK, we can look at the pre-defined english stop words</p>

<p>Tokenization is the act of breaking up a sequence of strings into pieces such as words, keywords, phrases, symbols and other elements called tokens. … Tokenization is used in computer science, where it plays a large part in the process of lexical analysis.</p>

<p>List of pre-defined stop words from NLTK package.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s">'english'</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['i', 'me', 'my', 'myself', 'we', 'our', 'ours', 'ourselves', 'you', "you're", "you've",
"you'll", "you'd", 'your', 'yours', 'yourself', 'yourselves', 'he', 'him', 'his', 'himself',
'she', "she's", 'her', 'hers', 'herself', 'it', "it's", 'its', 'itself', 'they', 'them', 'their',
'theirs', 'themselves', 'what', 'which', 'who', 'whom', 'this', 'that', "that'll", 'these',
'those', 'am', 'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'having',
'do', 'does', 'did', 'doing', 'a', 'an', 'the', 'and', 'but', 'if', 'or', 'because', 'as', 'until',
'while', 'of', 'at', 'by', 'for', 'with', 'about', 'against', 'between', 'into', 'through', 'during',
'before', 'after', 'above', 'below', 'to', 'from', 'up', 'down', 'in', 'out', 'on', 'off', 'over',
'under', 'again', 'further', 'then', 'once', 'here', 'there', 'when', 'where', 'why', 'how', 'all',
'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no', 'nor', 'not', 'only',
'own', 'same', 'so', 'than', 'too', 'very', 's', 't', 'can', 'will', 'just', 'don', "don't", 'should',
"should've", 'now', 'd', 'll', 'm', 'o', 're', 've', 'y', 'ain', 'aren', "aren't", 'couldn', "couldn't",
'' 'didn', "didn't", 'doesn', "doesn't", 'hadn', "hadn't", 'hasn', "hasn't", 'haven', "haven't", 'isn',
"isn't", 'ma', 'mightn', "mightn't", 'mustn', "mustn't", 'needn', "needn't", 'shan', "shan't", 'shouldn',
"shouldn't", 'wasn', "wasn't", 'weren', "weren't", 'won', "won't", 'wouldn', "wouldn't"]
</code></pre></div></div>

<p>The task of preprocessing can be nicely visualized with this image. Keep in mind that our preprocessing task will do a few extra things, since the domain we are working with is Twitter, which will also contain usernames, GIFs and hyperlinks.</p>

<p><img src="/assets/images/twitter/tokenize.pbm" alt="" /></p>

<p>We’ve created a class to handle the preprocessing, notice that all preprocessing can be done using just the
<code class="highlighter-rouge">re</code> and <code class="highlighter-rouge">nltk</code> packages.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PreProcessTweets</span><span class="p">:</span>
    <span class="c1">#Constructor
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Create list of pre-defined stoiterablepwords + extras
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_stopwords</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s">'english'</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s">'AT_USER'</span><span class="p">,</span><span class="s">'URL'</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">processTweets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_tweets</span><span class="p">):</span>
        <span class="n">processedTweets</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">list_of_tweets</span><span class="p">:</span>
            <span class="n">processedTweets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_processTweet</span><span class="p">(</span><span class="n">tweet</span><span class="p">[</span><span class="s">"text"</span><span class="p">]),</span> <span class="n">tweet</span><span class="p">[</span><span class="s">"label"</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">processedTweets</span>

    <span class="c1"># Process Tweet -&gt; remove all information except the tweet text(lowercased, all punctuation removed)
</span>    <span class="k">def</span> <span class="nf">_processTweet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tweet</span><span class="p">):</span>
        <span class="c1">#Convert all letters -&gt; lowercase
</span>        <span class="n">tweet</span> <span class="o">=</span> <span class="n">tweet</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># remove URL's
</span>        <span class="n">tweet</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'((www</span><span class="err">\</span><span class="s">.[^</span><span class="err">\</span><span class="s">s]+)|(https?://[^</span><span class="err">\</span><span class="s">s]+))'</span><span class="p">,</span> <span class="s">'URL'</span><span class="p">,</span> <span class="n">tweet</span><span class="p">)</span>
        <span class="c1">#remove usernames
</span>        <span class="n">tweet</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">'@[^</span><span class="err">\</span><span class="s">s]+'</span><span class="p">,</span> <span class="s">'AT_USER'</span><span class="p">,</span> <span class="n">tweet</span><span class="p">)</span>
        <span class="c1">#remove hash from hashtag
</span>        <span class="n">tweet</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">r'#([^\s]+)'</span><span class="p">,</span> <span class="s">r'\1'</span><span class="p">,</span> <span class="n">tweet</span><span class="p">)</span>
        <span class="c1"># tokenize words and remove repeated characters (helloooooo -&gt; hello)
</span>        <span class="n">tweet</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stopwords</span><span class="p">):</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">word_list</span>

</code></pre></div></div>

<p>Now to do the actual preprocessing. We create our PreProcessTweets() class and pass in our trainingSet to the <code class="highlighter-rouge">processTweets()</code> function. <br />
This returns a now processed training set which as discussed above will have stopwords,punctuation, usernames, url’s, etc. removed.</p>

<p>NOTE:<br />
My <code class="highlighter-rouge">twitterTraining</code> set has 1,600,000 observations. As per NLTK documentation, this package does not handle large datasets well. <br /></p>

<p><img src="/assets/images/twitter/nltk_large_data.JPG" alt="" /></p>

<p>So, while it would be nice to have all those items contribute to the training, the package just won’t handle it. I’ve reduced the size to 20,000.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tweetProcesser</span> <span class="o">=</span> <span class="n">PreProcessTweets</span><span class="p">()</span>
<span class="c1"># preprocessedTrainingSet = tweetProcesser.processTweets(twitterTraining)
</span><span class="n">newTraining</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">newTraining</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">twitterTraining</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10000</span><span class="p">])</span>
<span class="n">newTraining</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">twitterTraining</span><span class="p">[</span><span class="mi">1590000</span><span class="p">:</span><span class="mi">1600000</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">newTraining</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">newTraining</span><span class="p">)</span>
<span class="n">train_set_pre</span> <span class="o">=</span> <span class="n">newTraining</span><span class="p">[:</span><span class="mi">15000</span><span class="p">]</span>
<span class="n">dev_test_set_pre</span> <span class="o">=</span> <span class="n">newTraining</span><span class="p">[</span><span class="mi">15000</span><span class="p">:]</span>
<span class="n">preprocessedTrainingSet</span> <span class="o">=</span> <span class="n">tweetProcesser</span><span class="o">.</span><span class="n">processTweets</span><span class="p">(</span><span class="n">train_set_pre</span><span class="p">)</span>
<span class="n">preprocessedDevTestSet</span> <span class="o">=</span> <span class="n">tweetProcesser</span><span class="o">.</span><span class="n">processTweets</span><span class="p">(</span><span class="n">dev_test_set_pre</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preprocessedTrainingSet</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">preprocessedDevTestSet</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>15000
5000
</code></pre></div></div>

<p>Each observation is represented as below</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(['awww', "'s", 'bummer', 'shoulda', 'got', 'david', 'carr', 'third', 'day'], 'negative')

  - The tweet is has been processed and tokenized and so the object contains the tokenized tweet along with the attached label.
</code></pre></div></div>

<p>An important step taken above can be visualzed as so…
<img src="/assets/images/twitter/corpus.png" alt="" /></p>

<p>We’ve taken our development set <code class="highlighter-rouge">TwitterTraining</code>(subsetted into <code class="highlighter-rouge">NewTraining</code>(size 20,000)) and split that out into our Training Set(<code class="highlighter-rouge">train_set_pre</code>) and our Development Test Set(<code class="highlighter-rouge">dev_test_set_pre</code>). Each of these sets are passed through the preprocessing flow. <br />
<br />
In the next section the training set will be used to train the classifier and then run that classifier on the Development Test set to gain the accuracy and also to generate a list of errors the classifier makes in prediction, which can then be used in <code class="highlighter-rouge">error analysis</code> if desired.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"First Preprocessed Training Tweet: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">preprocessedTrainingSet</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Last Preprocessed Training Tweet: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">preprocessedTrainingSet</span><span class="p">[</span><span class="mi">19999</span><span class="p">]))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>First Preprocessed Training Tweet: (['awww', "'s", 'bummer', 'shoulda', 'got', 'david', 'carr', 'third', 'day'], 'negative')
Last Preprocessed Training Tweet: (['happy', 'charitytuesday'], 'positive')
</code></pre></div></div>

<p>Now the same preprocessing to our test set.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preprocessedTestSet</span> <span class="o">=</span> <span class="n">tweetProcesser</span><span class="o">.</span><span class="n">processTweets</span><span class="p">(</span><span class="n">testDataSet</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="build-a-dictionary">Build a dictionary…</h2>

<p>Compare every word in the training set against each tweet we have, creating a new binary feature which represents wether the word in our vocabulary is resident in the tweet or not</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">buildVocabulary</span><span class="p">(</span><span class="n">processedTrainingSet</span><span class="p">):</span>
    <span class="n">all_words</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">sentiment</span><span class="p">)</span> <span class="ow">in</span> <span class="n">processedTrainingSet</span><span class="p">:</span>
        <span class="n">all_words</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>

    <span class="c1"># Distribution of the words in all_words
</span>    <span class="n">wordlist</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">FreqDist</span><span class="p">(</span><span class="n">all_words</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">wordlist</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
    <span class="c1"># take top 3,000 most common words
</span>    <span class="n">word_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wordlist</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="mi">3000</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">word_features</span>


<span class="k">def</span> <span class="nf">extract_features</span><span class="p">(</span><span class="n">tweet</span><span class="p">):</span>
    <span class="n">tweet_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word_features</span><span class="p">:</span>
        <span class="n">features</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="ow">in</span> <span class="n">tweet_words</span><span class="p">)</span>
        <span class="c1">#features['contains(%s)' % word] = (word in tweet_words)
</span>    <span class="k">return</span> <span class="n">features</span>
</code></pre></div></div>

<p>So now we have a dictionary called <code class="highlighter-rouge">word_features</code> this contains every word in the training set and the count of its occurences, for example <code class="highlighter-rouge">(cat, 700)</code>, this says the word CAT has appeared in our training set 700 times.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Build word features set
</span><span class="n">word_features</span> <span class="o">=</span> <span class="n">buildVocabulary</span><span class="p">(</span><span class="n">preprocessedTrainingSet</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[('...', 3583), ("'s", 2345), ("n't", 2240), ("'m", 1640), ('good', 1227), ('day', 1177), ('get', 1090), ('work', 1084), ('today', 1015), ('quot', 970), ('go', 922), ('like', 890), ('got', 848), ('going', 805), ('love', 746)]
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">featuresets</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">apply_features</span><span class="p">(</span><span class="n">extract_features</span><span class="p">,</span> <span class="n">preprocessedTrainingSet</span><span class="p">)</span>
<span class="n">featuresets_dev_test</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">apply_features</span><span class="p">(</span><span class="n">extract_features</span><span class="p">,</span> <span class="n">preprocessedDevTestSet</span><span class="p">)</span>
</code></pre></div></div>

<p>The 2 lines above build whats called a feature set. Each item in this feature set or vector represents a tweet from the training set. <br />
Each vector item contains every word in the entire training set paired with a boolean which represents wether that word is present in the tweet, along with the pre-defined sentiment. The structure is displayed below.</p>

<p><code class="highlighter-rouge">[ listOf(every word in training set : true/false(present in tweet)),    pre-defined sentiment(positive/negative) ]</code></p>

<h2 id="classification-and-analysis">Classification and Analysis</h2>
<p>Now to train the bayes classifier on the training features we’ve just created</p>

<p>The most important and the shortest part of this project, training the classifier. NLTK makes this easy with a simple function. Since our training set contained 160,000 tweets, this may take quite a bit of time to train. I personally went to work out and get some coffee so I’m not sure on the exact amount of time.</p>

<p>It would be interesting however to find a python package that allows some kind of wrapper around functions which counts the time until completion.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NBayesClassifier</span> <span class="o">=</span> <span class="n">nltk</span><span class="o">.</span><span class="n">NaiveBayesClassifier</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">featuresets</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">NBayesClassifier</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">featuresets</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;nltk.classify.naivebayes.NaiveBayesClassifier object at 0x000002DBA5EDA2C8&gt;
15000
</code></pre></div></div>

<p>Above we print the Classifier Object just to confirm it has been created and is in Memory, next we look at the length of our feature set. 15,000..the size of our Development Training Set</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="s">"Classifier accuracy percent:"</span><span class="p">,(</span><span class="n">nltk</span><span class="o">.</span><span class="n">classify</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">NBayesClassifier</span><span class="p">,</span> <span class="n">featuresets_dev_test</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">NBayesClassifier</span><span class="o">.</span><span class="n">show_most_informative_features</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Classifier accuracy percent: 77.27000000000001
Most Informative Features
                  throat = True           negati : positi =     39.7 : 1.0
                headache = True           negati : positi =     38.3 : 1.0
                  easter = True           negati : positi =     32.3 : 1.0
                    snow = True           negati : positi =     27.9 : 1.0
                    died = True           negati : positi =     24.3 : 1.0
                  spring = True           negati : positi =     20.6 : 1.0
           unfortunately = True           negati : positi =     19.0 : 1.0
                    argh = True           negati : positi =     18.3 : 1.0
                   lines = True           positi : negati =     15.0 : 1.0
                    loss = True           negati : positi =     14.3 : 1.0
                      22 = True           negati : positi =     13.7 : 1.0
                   hates = True           negati : positi =     13.4 : 1.0
                    dang = True           negati : positi =     13.0 : 1.0
                   hurts = True           negati : positi =     12.4 : 1.0
                  tweeps = True           positi : negati =     12.3 : 1.0
</code></pre></div></div>

<p>Here we are gaining some metric on our classifier, testing the accuracy. As you can see, currently it’s at ~77%.</p>

<p>The <code class="highlighter-rouge">show_most_informative_features()</code> function is very useful. From the output we can see that for example</p>

<p><code class="highlighter-rouge">throat</code> appears in a negative tweet almost 40x more than in a positive.</p>

<h2 id="examine-errors">Examine Errors</h2>

<p>Since of course the classifier will not have 100% accuracy, we now have the chance to examine the individual error cases where the classifier predicted the wrong label. <br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Examine Errors
</span>
<span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>


<span class="k">for</span> <span class="n">dict_item</span> <span class="ow">in</span> <span class="n">dev_test_set_pre</span><span class="p">:</span>
    <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_item</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">guess</span> <span class="o">=</span> <span class="n">NBayesClassifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">extract_features</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span><span class="p">(</span><span class="n">guess</span> <span class="o">!=</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">guess</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
</code></pre></div></div>

<p>^ Looking through the Development test set on which we performed the accuracy assesment, we generate a list of the tweets in which the wrong label was predicted. Each item in the developement set looks like this…</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'tweet_id': '2191372252', 'text': 'good morning world ', 'label': 'positive'}
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>('negative', 'positive', '306 letters to be sent out!! better start writing now ')
2531
</code></pre></div></div>

<p>After compiling that list of errors, we now can peek at the first one, this is saying <br />
<code class="highlighter-rouge">Correct Label = Negative, Predicted Label = Positive, Tweet Text = ....</code> <br />
We also see that it mispredicted ~2500 labels</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'correct={:&lt;8}, guess={:&gt;8s}, text={:&lt;30}'</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">guess</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
</code></pre></div></div>

<p>^ We can then print this list and inspect for patterns to help determine what additional pieces would allow the classifier to make the right decision, or alternatively which pieces are tricking the classifier into making the wrong decisions.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>correct=negative, guess=positive, text= Heroes is losing it's momentum ): come on writers pick it up!!!
correct=negative, guess=positive, text= my housemaid.........oh I hate her :s  I guess she has alzheimers she didn't even know MY NAME
correct=negative, guess=positive, text= not looking forward to my 10 hour shift tomorrow.
correct=negative, guess=positive, text=#3 woke up and was having an accident - &amp;quot;It's pushing, it's pushing!&amp;quot; he was crying because he couldn't stop from wetting his pants.
correct=negative, guess=positive, text=#Lahore @ EssexEating only been to Lahore.  http://tinyurl.com/dbdjvz
correct=negative, guess=positive, text=#dreams Had to speak at night honoring michelle obama as fashion icon. Did so wearing her clothes. Got pee on them while changing.
correct=negative, guess=positive, text=#i36 Hope I'm feeling better by thursday, will be seriously annoyed if I'm ill over LAN
correct=negative, guess=positive, text=&amp;quot;April SNOW showers. kill may flowers&amp;quot;
.
.
.
.
</code></pre></div></div>

<h2 id="testing-classifier">Testing Classifier</h2>

<p>Now we are creating a vector of predicted sentiments for each tweet in the test set.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># classifing on the extracted feature vector for all the tweets in test set, which already have the sentiment labeled as NULL
</span><span class="n">NBResultLabels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">preprocessedTestSet</span><span class="p">:</span>
    <span class="n">NBResultLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NBayesClassifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">extract_features</span><span class="p">(</span><span class="n">tweet</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MAJORITY RULE
</span><span class="k">print</span><span class="p">(</span><span class="s">"Positive Labels: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NBResultLabels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'positive'</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Negative Labels: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NBResultLabels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'negative'</span><span class="p">)))</span>
<span class="k">if</span> <span class="p">(</span><span class="n">NBResultLabels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'positive'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">NBResultLabels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'negative'</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"POSITIVE"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"POSITIVE PERCENTAGE = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">NBResultLabels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'positive'</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">NBResultLabels</span><span class="p">))</span> <span class="o">+</span> <span class="s">"</span><span class="si">%</span><span class="s">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"NEGATIVE"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"NEGATIVE PERCENTAGE = "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">NBResultLabels</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">'negative'</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">NBResultLabels</span><span class="p">))</span> <span class="o">+</span> <span class="s">"</span><span class="si">%</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Positive Labels: 79
Negative Labels: 21
POSITIVE
POSITIVE PERCENTAGE = 79.0%
</code></pre></div></div>

<p>The keyword parameter I used was <code class="highlighter-rouge">blm</code> which stands for <code class="highlighter-rouge">Black lives matter</code>, a pretty important topic at the time of this writing. It’s nice to see that ~80 of the 100 tweets we fetched from the API have been classified as positive.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-06-06T00:00:00-04:00">June 6, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Twitter+Sentiment+Analysis%20http%3A%2F%2Flocalhost%3A4000%2Ftwitter%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Ftwitter%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Ftwitter%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/tractor/" class="pagination--pager" title="Tractor
">Previous</a>
    
    
      <a href="/twitter-mobile/" class="pagination--pager" title="Twitter Mobile
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/twitter-mobile/" rel="permalink">Twitter Mobile
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Data Science
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/tractor/" rel="permalink">Tractor
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  73 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Data Science
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/tractor-regression/" rel="permalink">Early Tractorization of Rural America
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Data Science
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Kyle Amyx. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>















  </body>
</html>
